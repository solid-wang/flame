package k8s

import (
	"fmt"
	"github.com/spf13/viper"
	"k8s.io/client-go/kubernetes"
	"k8s.io/client-go/rest"
	"k8s.io/client-go/tools/clientcmd"
)

func NewK8sClient() *kubernetes.Clientset {
	var config *rest.Config
	var err error
	// creates the in-cluster config
	if viper.GetString("env") == "dev" {
		kubeConfig := []byte(`apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyTVRnMk5ETTJPRGt3SGhjTk1qRXdOREUzTURjeE5EUTVXaGNOTXpFd05ERTFNRGN4TkRRNQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyTVRnMk5ETTJPRGt3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTV1UvVStreENINkNaUEdVbmRwNzVxWk1TNVRIM3FEaE5BNTRRck9ka3EKNHFaWW1YNFNTTVZpbm81S09SNWU1aDhmd2FCR0doRjRBR2hyUWRwOVpacDhvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVlVNllWblAzWkxSc0lEbzVZL0IyCnNNRHRUWmN3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUpJalMzaS84ZTk2YzlQdTh4OHFMQ0p4NmZIeGRHSnAKaEFwMmJpOGZLdDN5QWlBbEJOTVpobFB5bks5MklMTFYyK3M3THJ3d3hSVnNBMXhpbnRmcGtGMTFsZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://10.211.55.4:6443
  name: default
contexts:
- context:
    cluster: default
    user: default
  name: default
current-context: default
kind: Config
preferences: {}
users:
- name: default
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJTnl3ZWdURW5lNFF3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOakU0TmpRek5qZzVNQjRYRFRJeE1EUXhOekEzTVRRME9Wb1hEVEl5TURReApOekEzTVRRME9Wb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJKc1BYOE40c1ZtWmlGTzUKc083TUlRbmZTTi9aNkQrVk9YanVmOGRiRzgreGo4Z0h6elkyZDJERnlTdUFaaEZoMUVuZ21KRlpxWThHVUkyYQprVlhHQzVDalNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCUVFzMTlSR1VOeHEwTGRwUU83amZPdG9hVjlLakFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlFQTUxdG94R09XOEtzaWR2U2szTTJhdk9sK1pCV0JkeXJDTUZWSDJpUXo2c2tDSUdNRW85MVFGYjc1ZHQ5cwpJM1NuL1JIRTZsWVpXc294bWFMb2lRZnI0Y2JSCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyTVRnMk5ETTJPRGt3SGhjTk1qRXdOREUzTURjeE5EUTVXaGNOTXpFd05ERTFNRGN4TkRRNQpXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyTVRnMk5ETTJPRGt3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSSXRoazBUY3hvK000OGlCSnNhWkxDTXdHUEJSWm9zU3V2N2ZmNXlTcU4KczZkSVhjNm9aUFVmTllIa0VYUCtUVmFmcG9Oc3pwZDRENHR3YWJ5dnJlWkRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVUVMTmZVUmxEY2F0QzNhVUR1NDN6CnJhR2xmU293Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUlnREZXMFhZZVYweDdlK3VFUXpENVBCaFFmTkExQUR3NzQKUXR2NHJERkcrQjRDSVFDRjh1cGVONEVIaTB3K1ViRWZacnpnRmQ2b21TMmFXaUVZdGxkai8rR29adz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUpJZjdaT0c3R0pBeG9ZZTgwMVljSkY2KytiaVZVQzFZRm11MTRKRTlBNENvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFbXc5ZnczaXhXWm1JVTdtdzdzd2hDZDlJMzlub1A1VTVlTzUveDFzYno3R1B5QWZQTmpaMwpZTVhKSzRCbUVXSFVTZUNZa1ZtcGp3WlFqWnFSVmNZTGtBPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=`)
		config, err = clientcmd.RESTConfigFromKubeConfig(kubeConfig)
		if err != nil {
			fmt.Println(err)
		}
	} else {
		config, err = rest.InClusterConfig()
		if err != nil {
			fmt.Println(err)
		}
	}
	// creates the clientSet
	clientSet, err := kubernetes.NewForConfig(config)
	if err != nil {
		fmt.Print(err)
	}

	return clientSet
}
